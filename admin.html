<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrativo - Sistema de Caba√±as</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1e293b;
        }

        .admin-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            margin: 20px;
            padding: 30px;
            min-height: calc(100vh - 40px);
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            color: #64748b;
            font-weight: 600;
        }

        .tabs-container {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .tabs-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            background: #e2e8f0;
            color: #64748b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-button:hover {
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        /* Asegurar que las pesta√±as ocultas est√©n realmente ocultas */
        .tab-content.hidden {
            display: none !important;
        }
        
        /* Asegurar que las pesta√±as activas est√©n visibles */
        .tab-content:not(.hidden) {
            display: block !important;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-available { background: #dcfce7; color: #166534; }
        .status-occupied { background: #dbeafe; color: #1e40af; }
        .status-out { background: #fef3c7; color: #92400e; }
        .status-expired { background: #fee2e2; color: #991b1b; }

        .filters-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filter-input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .export-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #fca5a5;
        }

        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #86efac;
        }

        @media (max-width: 768px) {
            .admin-container {
                margin: 10px;
                padding: 20px;
            }
            
            .dashboard-title {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .export-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 p-4">
        <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-8 text-center">
                <h1 class="text-4xl font-bold mb-2">Dashboard Administrativo</h1>
                <p class="text-xl opacity-90">Sistema de Gesti√≥n de Caba√±as - An√°lisis y Reportes</p>
            </div>

                    <!-- Mensaje de Estado -->
        <div id="statusMessage" class="mx-6 mb-4 p-4 bg-blue-100 border border-blue-400 text-blue-700 rounded-lg hidden">
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-3"></div>
                <span id="statusText">Conectando con Firebase...</span>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 p-6 bg-gray-50">
                <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                    <div class="text-3xl font-bold text-blue-600" id="totalCabanas">18</div>
                    <div class="text-gray-600">Total Caba√±as</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                    <div class="text-3xl font-bold text-green-600" id="cabanasOcupadas">0</div>
                    <div class="text-gray-600">Ocupadas</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                    <div class="text-3xl font-bold text-yellow-600" id="cabanasEnBreak">0</div>
                    <div class="text-gray-600">En Break</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                    <div class="text-3xl font-bold text-red-600" id="cabanasExpiradas">0</div>
                    <div class="text-gray-600">Expiradas</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                    <div class="text-3xl font-bold text-purple-600" id="totalLogs">0</div>
                    <div class="text-gray-600">Total Logs</div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                    <div class="text-3xl font-bold text-indigo-600" id="tiempoPromedio">0m</div>
                    <div class="text-gray-600">Promedio Break</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="p-6">
                <div class="flex flex-wrap gap-2 mb-6">
                    <button class="tab-btn active px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold" onclick="showTab('overview')">
                        <i class="fas fa-chart-line mr-2"></i>Resumen
                    </button>
                                                    <button class="tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold" onclick="showTab('cabanas'); console.log('üîò Bot√≥n caba√±as clickeado');">
                                    <i class="fas fa-home mr-2"></i>Estado Caba√±as
                                </button>
                                                    <button class="tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold" onclick="showTab('logs'); console.log('üîò Bot√≥n logs clickeado');">
                                    <i class="fas fa-list mr-2"></i>Logs del Sistema
                                </button>
                                <button class="tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold" onclick="showTab('analytics'); console.log('üîò Bot√≥n analytics clickeado');">
                                    <i class="fas fa-chart-bar mr-2"></i>Anal√≠ticas
                                </button>
                                <button class="tab-btn px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold" onclick="showTab('reports'); console.log('üîò Bot√≥n reports clickeado');">
                                    <i class="fas fa-file-alt mr-2"></i>Reportes
                                </button>
                </div>

                <!-- Tab Content -->
                <div id="overview" class="tab-content active">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                                            <div class="bg-white rounded-xl p-6 shadow-lg">
                                        <h3 class="text-xl font-bold mb-4">Estado Actual de Caba√±as</h3>
                                        <div class="chart-container">
                                            <canvas id="statusChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-xl p-6 shadow-lg">
                                        <h3 class="text-xl font-bold mb-4">Actividad por Hora</h3>
                                        <div class="chart-container">
                                            <canvas id="activityChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                    </div>
                </div>

                <div id="cabanas" class="tab-content hidden">
                    <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                        <div class="flex flex-wrap gap-4 items-center">
                            <input type="text" id="searchCabanas" placeholder="Buscar por n√∫mero o habitaci√≥n..." 
                                   class="px-4 py-2 border border-gray-300 rounded-lg flex-1">
                            <select id="filterStatus" class="px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="">Todos los estados</option>
                                <option value="available">Disponible</option>
                                <option value="occupied">Ocupada</option>
                                <option value="out">En Break</option>
                                <option value="expired">Expirada</option>
                            </select>
                            <button class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold" onclick="filterCabanas()">
                                <i class="fas fa-search mr-2"></i>Filtrar
                            </button>
                            <button class="px-6 py-2 bg-gray-500 text-white rounded-lg font-semibold" onclick="clearFilters()">
                                <i class="fas fa-times mr-2"></i>Limpiar
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N√∫mero</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Habitaci√≥n</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tiempo Restante</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">√öltima Actualizaci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody id="cabanasTableBody" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                            <div class="flex items-center justify-center">
                                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                                                Cargando datos...
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="logs" class="tab-content hidden">
                    <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                        <div class="flex flex-wrap gap-4 items-center">
                            <input type="date" id="logDateFrom" class="px-4 py-2 border border-gray-300 rounded-lg">
                            <input type="date" id="logDateTo" class="px-4 py-2 border border-gray-300 rounded-lg">
                            <select id="logActionFilter" class="px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="">Todas las acciones</option>
                                <option value="occupied">Ocupada</option>
                                <option value="out">Break iniciado</option>
                                <option value="expired">Expirada</option>
                                <option value="available">Desocupada</option>
                            </select>
                            <button class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold" onclick="filterLogs()">
                                <i class="fas fa-search mr-2"></i>Filtrar
                            </button>
                            <button class="px-6 py-2 bg-gray-500 text-white rounded-lg font-semibold" onclick="clearLogFilters()">
                                <i class="fas fa-times mr-2"></i>Limpiar
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha/Hora</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Caba√±a</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acci√≥n</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Habitaci√≥n</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                                    </tr>
                                </thead>
                                <tbody id="logsTableBody" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                            <div class="flex items-center justify-center">
                                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                                                Cargando logs...
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="analytics" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                                            <div class="bg-white rounded-xl p-6 shadow-lg">
                                        <h3 class="text-xl font-bold mb-4">Uso de Caba√±as por D√≠a</h3>
                                        <div class="chart-container">
                                            <canvas id="dailyUsageChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-xl p-6 shadow-lg">
                                        <h3 class="text-xl font-bold mb-4">Duraci√≥n Promedio de Breaks</h3>
                                        <div class="chart-container">
                                            <canvas id="breakDurationChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-xl p-6 shadow-lg lg:col-span-2">
                                        <h3 class="text-xl font-bold mb-4">Habitaciones M√°s Activas</h3>
                                        <div class="chart-container">
                                            <canvas id="roomActivityChart" width="400" height="200"></canvas>
                                        </div>
                                    </div>
                    </div>
                </div>

                <div id="reports" class="tab-content hidden">
                    <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                        <h3 class="text-xl font-bold mb-4">Generar Reportes</h3>
                        <div class="flex flex-wrap gap-4 items-center mb-4">
                            <input type="date" id="reportDateFrom" class="px-4 py-2 border border-gray-300 rounded-lg">
                            <input type="date" id="reportDateTo" class="px-4 py-2 border border-gray-300 rounded-lg">
                            <select id="reportType" class="px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="daily">Reporte Diario</option>
                                <option value="weekly">Reporte Semanal</option>
                                <option value="monthly">Reporte Mensual</option>
                                <option value="custom">Rango Personalizado</option>
                            </select>
                        </div>
                        <div class="flex gap-4">
                            <button class="px-6 py-2 bg-green-600 text-white rounded-lg font-semibold" onclick="generateReport('pdf')">
                                <i class="fas fa-file-pdf mr-2"></i>Exportar PDF
                            </button>
                            <button class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold" onclick="generateReport('excel')">
                                <i class="fas fa-file-excel mr-2"></i>Exportar Excel
                            </button>
                            <button class="px-6 py-2 bg-gray-600 text-white rounded-lg font-semibold" onclick="generateReport('csv')">
                                <i class="fas fa-file-csv mr-2"></i>Exportar CSV
                            </button>
                        </div>
                    </div>
                    
                    <div id="reportPreview" class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-bold mb-4">Vista Previa del Reporte</h3>
                        <div id="reportContent">
                            <p class="text-gray-500">Selecciona un rango de fechas y tipo de reporte para generar la vista previa.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Estilos del Dashboard Administrativo */
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        .tab-btn.active {
            background-color: #2563eb; /* blue-600 */
            color: white;
        }
        
        .tab-btn:not(.active) {
            background-color: #e5e7eb; /* gray-200 */
            color: #4b5563; /* gray-700 */
        }
        
        /* Animaciones */
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .grid-cols-6 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        
        /* Control de tama√±o de gr√°ficos */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }
        
        .chart-container canvas {
            max-height: 300px !important;
            max-width: 100% !important;
        }
        
        /* Gr√°ficos espec√≠ficos */
        #statusChart {
            max-height: 250px !important;
        }
        
        #activityChart {
            max-height: 300px !important;
        }
        
        #dailyUsageChart {
            max-height: 300px !important;
        }
        
        #breakDurationChart {
            max-height: 300px !important;
        }
        
        #roomActivityChart {
            max-height: 400px !important;
        }
    </style>

    <script type="module">
        // Dashboard Administrativo - Sistema de Caba√±as
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue, get, query, orderByChild, startAt, endAt } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAd2bZmSEWzKMYoAn2p-chUstWWnGYMQig",
            authDomain: "secrets-e9d81.firebaseapp.com",
            databaseURL: "https://secrets-e9d81-default-rtdb.firebaseio.com",
            projectId: "secrets-e9d81",
            storageBucket: "secrets-e9d81.firebasestorage.app",
            messagingSenderId: "806442425481",
            appId: "1:806442425481:web:c551406b20651b4d85fa58",
            measurementId: "G-8M52F3T512"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // Constantes del sistema
        const NUM_CABANAS = 18; // N√∫mero total de caba√±as
        
        // Variables globales
        let cabanasData = {};
        let logsData = [];
        let currentCharts = {};

        // Inicializar dashboard
        async function initializeDashboard() {
            try {
                showStatus('üöÄ Iniciando dashboard administrativo...', 'info');
                
                // Autenticaci√≥n an√≥nima
                showStatus('üîê Autenticando con Firebase...', 'info');
                await signInAnonymously(auth);
                console.log('‚úÖ Autenticado en dashboard admin');
                
                // Cargar datos
                showStatus('üì• Cargando datos de caba√±as...', 'info');
                await loadCabanasData();
                
                showStatus('üìù Cargando logs del sistema...', 'info');
                await loadLogsData();
                
                // Configurar listeners en tiempo real
                showStatus('üîó Configurando sincronizaci√≥n en tiempo real...', 'info');
                setupRealtimeListeners();
                
                showStatus('‚úÖ Dashboard inicializado correctamente', 'success');
                setTimeout(() => hideStatus(), 2000);
                
            } catch (error) {
                console.error('‚ùå Error al inicializar dashboard:', error);
                showError(`Error de conexi√≥n con Firebase: ${error.message}`);
            }
        }

        // Cargar datos de caba√±as
        async function loadCabanasData() {
            try {
                console.log('üîÑ Cargando datos de caba√±as...');
                const cabanasRef = ref(db, 'cabanas');
                const snapshot = await get(cabanasRef);
                
                console.log('üìä Snapshot de caba√±as:', snapshot);
                
                if (snapshot.exists()) {
                    cabanasData = snapshot.val();
                    console.log('‚úÖ Datos de caba√±as cargados:', cabanasData);
                    console.log('üî¢ N√∫mero de caba√±as:', Object.keys(cabanasData).length);
                    
                    updateStats();
                    updateCabanasTable();
                    updateCharts();
                } else {
                    console.log('‚ö†Ô∏è No hay datos de caba√±as en Firebase');
                    cabanasData = {};
                    updateStats();
                    updateCabanasTable();
                }
            } catch (error) {
                console.error('‚ùå Error al cargar caba√±as:', error);
                showError(`Error al cargar caba√±as: ${error.message}`);
            }
        }

        // Cargar logs del sistema
        async function loadLogsData() {
            try {
                console.log('üîÑ Cargando logs del sistema...');
                const logsRef = ref(db, 'logs');
                const snapshot = await get(logsRef);
                
                console.log('üìä Snapshot de logs:', snapshot);
                
                if (snapshot.exists()) {
                    logsData = Object.values(snapshot.val()).sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                    console.log('‚úÖ Logs cargados:', logsData.length, 'registros');
                    updateLogsTable();
                    updateStats();
                } else {
                    console.log('‚ö†Ô∏è No hay logs en Firebase');
                    logsData = [];
                    updateLogsTable();
                    updateStats();
                }
            } catch (error) {
                console.error('‚ùå Error al cargar logs:', error);
                showError(`Error al cargar logs: ${error.message}`);
            }
        }

        // Configurar listeners en tiempo real
        function setupRealtimeListeners() {
            // Listener para caba√±as
            const cabanasRef = ref(db, 'cabanas');
            onValue(cabanasRef, (snapshot) => {
                if (snapshot.exists()) {
                    cabanasData = snapshot.val();
                    updateStats();
                    updateCabanasTable();
                    updateCharts();
                }
            });

            // Listener para logs
            const logsRef = ref(db, 'logs');
            onValue(logsRef, (snapshot) => {
                if (snapshot.exists()) {
                    logsData = Object.values(snapshot.val()).sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                    updateLogsTable();
                    updateStats();
                }
            });
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const totalCabanas = NUM_CABANAS; // Siempre NUM_CABANAS caba√±as
            const cabanasOcupadas = Object.values(cabanasData).filter(c => c.status === 'occupied').length;
            const cabanasEnBreak = Object.values(cabanasData).filter(c => c.status === 'out').length;
            const cabanasExpiradas = Object.values(cabanasData).filter(c => c.status === 'expired').length;
            const cabanasDisponibles = totalCabanas - cabanasOcupadas - cabanasEnBreak - cabanasExpiradas;
            const totalLogs = logsData.length;

            // Calcular tiempo promedio de break
            let tiempoPromedio = 0;
            const breaksCompletados = logsData.filter(log => 
                log.action === 'out' && log.details && log.details.startTime
            );
            
            if (breaksCompletados.length > 0) {
                const tiempos = breaksCompletados.map(log => {
                    const start = new Date(log.details.startTime);
                    const end = new Date(log.timestamp);
                    return (end - start) / (1000 * 60); // en minutos
                });
                tiempoPromedio = Math.round(tiempos.reduce((a, b) => a + b, 0) / tiempos.length);
            }

            // Actualizar UI
            document.getElementById('totalCabanas').textContent = totalCabanas;
            document.getElementById('cabanasOcupadas').textContent = cabanasOcupadas;
            document.getElementById('cabanasEnBreak').textContent = cabanasEnBreak;
            document.getElementById('cabanasExpiradas').textContent = cabanasExpiradas;
            document.getElementById('totalLogs').textContent = totalLogs;
            document.getElementById('tiempoPromedio').textContent = `${tiempoPromedio}m`;
        }

        // Actualizar tabla de caba√±as
        function updateCabanasTable(filteredData = null) {
            const tbody = document.getElementById('cabanasTableBody');
            if (!tbody) {
                console.error('‚ùå Tabla de caba√±as no encontrada');
                return;
            }

            tbody.innerHTML = '';

            const dataToShow = filteredData || Object.entries(cabanasData);
            
            // Si no hay datos filtrados, mostrar las NUM_CABANAS caba√±as con estado por defecto
            if (dataToShow.length === 0) {
                console.log(`üìã Generando tabla con ${NUM_CABANAS} caba√±as por defecto...`);
                
                for (let i = 1; i <= NUM_CABANAS; i++) {
                    const row = document.createElement('tr');
                    
                    // Crear badge de estado por defecto
                    const statusBadge = document.createElement('span');
                    statusBadge.className = 'inline-flex px-2 py-1 text-xs font-semibold rounded-full status-available';
                    statusBadge.textContent = 'Disponible';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">Caba√±a ${i}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${statusBadge.outerHTML}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            N/A
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            N/A
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            N/A
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                }
                
                console.log(`‚úÖ Tabla de caba√±as generada con ${NUM_CABANAS} caba√±as por defecto`);
                return;
            }
            
            dataToShow.forEach(([id, cabana]) => {
                const row = document.createElement('tr');
                
                // Calcular tiempo restante si est√° en break
                let tiempoRestante = '';
                if (cabana.status === 'out' && cabana.startTime) {
                    const elapsed = new Date().getTime() - new Date(cabana.startTime).getTime();
                    const remaining = (60 * 60 * 1000) - elapsed; // 60 minutos
                    if (remaining > 0) {
                        const minutes = Math.floor(remaining / 60000);
                        const seconds = Math.floor((remaining % 60000) / 1000);
                        tiempoRestante = `${minutes}m ${seconds}s`;
                    } else {
                        tiempoRestante = 'Expirado';
                    }
                }

                // Crear badge de estado
                const statusBadge = document.createElement('span');
                statusBadge.className = `inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusBadgeClass(cabana.status)}`;
                statusBadge.textContent = getStatusText(cabana.status);

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${id}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${statusBadge.outerHTML}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${cabana.roomNumber || 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${tiempoRestante || 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${cabana.lastUpdated ? new Date(cabana.lastUpdated).toLocaleString() : 'N/A'}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log(`‚úÖ Tabla de caba√±as actualizada con ${dataToShow.length} registros`);
        }

        // Actualizar tabla de logs
        function updateLogsTable(filteredData = null) {
            const tbody = document.getElementById('logsTableBody');
            if (!tbody) {
                console.error('‚ùå Tabla de logs no encontrada');
                return;
            }

            tbody.innerHTML = '';

            const dataToShow = filteredData || logsData;
            
            if (dataToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            No hay logs disponibles
                        </td>
                    </tr>
                `;
                return;
            }
            
            dataToShow.forEach(log => {
                const row = document.createElement('tr');
                
                // Crear badge de acci√≥n
                const actionBadge = document.createElement('span');
                actionBadge.className = `inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusBadgeClass(log.action)}`;
                actionBadge.textContent = getStatusText(log.action);

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${new Date(log.timestamp).toLocaleString()}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${log.cabinNumber}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${actionBadge.outerHTML}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${log.roomNumber || 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${log.userId || 'Sistema'}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log(`‚úÖ Tabla de logs actualizada con ${dataToShow.length} registros`);
        }

        // Obtener texto del estado
        function getStatusText(status) {
            const statusMap = {
                'available': 'Disponible',
                'occupied': 'Ocupada',
                'out': 'En Break',
                'expired': 'Expirada'
            };
            return statusMap[status] || status;
        }

        // Obtener clase CSS para el badge de estado
        function getStatusBadgeClass(status) {
            const statusClasses = {
                'available': 'bg-green-100 text-green-800',
                'occupied': 'bg-blue-100 text-blue-800',
                'out': 'bg-yellow-100 text-yellow-800',
                'expired': 'bg-red-100 text-red-800'
            };
            return statusClasses[status] || 'bg-gray-100 text-gray-800';
        }

        // Actualizar gr√°ficos
        function updateCharts() {
            console.log('üìä Iniciando actualizaci√≥n de gr√°ficos...');
            
            try {
                // Verificar que Chart.js est√© disponible
                if (typeof Chart === 'undefined') {
                    console.error('‚ùå Chart.js no est√° disponible');
                    return;
                }
                
                // Verificar que haya datos
                if (Object.keys(cabanasData).length === 0 && logsData.length === 0) {
                    console.log('‚ö†Ô∏è No hay datos para mostrar en los gr√°ficos');
                    return;
                }
                
                console.log('‚úÖ Chart.js disponible, actualizando gr√°ficos...');
                
                updateStatusChart();
                updateActivityChart();
                updateDailyUsageChart();
                updateBreakDurationChart();
                updateRoomActivityChart();
                
                console.log('‚úÖ Todos los gr√°ficos actualizados');
                
            } catch (error) {
                console.error('‚ùå Error al actualizar gr√°ficos:', error);
            }
        }

        // Gr√°fico de estado de caba√±as
        function updateStatusChart() {
            try {
                const ctx = document.getElementById('statusChart');
                if (!ctx) {
                    console.error('‚ùå Canvas de estado no encontrado');
                    return;
                }
                
                // Destruir gr√°fico anterior si existe
                if (currentCharts.statusChart) {
                    currentCharts.statusChart.destroy();
                    currentCharts.statusChart = null;
                }

                const statusCounts = {
                    available: Object.values(cabanasData).filter(c => c.status === 'available').length,
                    occupied: Object.values(cabanasData).filter(c => c.status === 'occupied').length,
                    out: Object.values(cabanasData).filter(c => c.status === 'out').length,
                    expired: Object.values(cabanasData).filter(c => c.status === 'expired').length
                };

                console.log('üìä Datos para gr√°fico de estado:', statusCounts);

                currentCharts.statusChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Disponible', 'Ocupada', 'En Break', 'Expirada'],
                        datasets: [{
                            data: [statusCounts.available, statusCounts.occupied, statusCounts.out, statusCounts.expired],
                            backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                            borderWidth: 2,
                            borderColor: '#ffffff',
                            hoverBorderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#ffffff',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${context.label}: ${context.parsed} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Gr√°fico de estado actualizado');
                
            } catch (error) {
                console.error('‚ùå Error al actualizar gr√°fico de estado:', error);
            }
        }

        // Gr√°fico de actividad por hora
        function updateActivityChart() {
            try {
                const ctx = document.getElementById('activityChart');
                if (!ctx) {
                    console.error('‚ùå Canvas de actividad no encontrado');
                    return;
                }
                
                // Destruir gr√°fico anterior si existe
                if (currentCharts.activityChart) {
                    currentCharts.activityChart.destroy();
                    currentCharts.activityChart = null;
                }

                // Agrupar logs por hora
                const hourlyActivity = {};
                logsData.forEach(log => {
                    const hour = new Date(log.timestamp).getHours();
                    hourlyActivity[hour] = (hourlyActivity[hour] || 0) + 1;
                });

                const labels = Array.from({length: 24}, (_, i) => `${i}:00`);
                const data = labels.map(hour => hourlyActivity[parseInt(hour)] || 0);

                console.log('üìä Datos para gr√°fico de actividad:', { labels, data });

                currentCharts.activityChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Actividades por Hora',
                            data: data,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#667eea',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Hora del D√≠a',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    maxTicksLimit: 12,
                                    maxRotation: 0
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'N√∫mero de Actividades',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    stepSize: 1
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        elements: {
                            point: {
                                hoverRadius: 6,
                                radius: 4
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Gr√°fico de actividad actualizado');
                
            } catch (error) {
                console.error('‚ùå Error al actualizar gr√°fico de actividad:', error);
            }
        }

        // Gr√°fico de uso diario
        function updateDailyUsageChart() {
            const ctx = document.getElementById('dailyUsageChart');
            if (currentCharts.dailyUsageChart) {
                currentCharts.dailyUsageChart.destroy();
            }

            // Agrupar por d√≠a de la semana
            const dailyUsage = {};
            logsData.forEach(log => {
                const day = new Date(log.timestamp).toLocaleDateString('es-ES', { weekday: 'long' });
                dailyUsage[day] = (dailyUsage[day] || 0) + 1;
            });

            const labels = ['lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado', 'domingo'];
            const data = labels.map(day => dailyUsage[day] || 0);

                            currentCharts.dailyUsageChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Actividades por D√≠a',
                            data: data,
                            backgroundColor: [
                                '#10b981', '#059669', '#047857', '#065f46', '#064e3b', '#022c22', '#012a16'
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            borderRadius: 6,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#ffffff',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed} actividades`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'D√≠a de la Semana',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    maxRotation: 0
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'N√∫mero de Actividades',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    stepSize: 1
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
        }

        // Gr√°fico de duraci√≥n de breaks
        function updateBreakDurationChart() {
            const ctx = document.getElementById('breakDurationChart');
            if (currentCharts.breakDurationChart) {
                currentCharts.breakDurationChart.destroy();
            }

            // Calcular duraciones de breaks
            const breakDurations = [];
            logsData.forEach(log => {
                if (log.action === 'out' && log.details && log.details.startTime) {
                    const start = new Date(log.details.startTime);
                    const end = new Date(log.timestamp);
                    const duration = Math.round((end - start) / (1000 * 60)); // en minutos
                    if (duration > 0 && duration <= 60) {
                        breakDurations.push(duration);
                    }
                }
            });

            // Agrupar por rangos de tiempo
            const ranges = ['0-15m', '16-30m', '31-45m', '46-60m'];
            const data = ranges.map((range, index) => {
                const min = index * 15;
                const max = (index + 1) * 15;
                return breakDurations.filter(d => d > min && d <= max).length;
            });

            currentCharts.breakDurationChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ranges,
                    datasets: [{
                        label: 'Caba√±as',
                        data: data,
                        backgroundColor: '#f59e0b'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Gr√°fico de actividad por habitaci√≥n
        function updateRoomActivityChart() {
            const ctx = document.getElementById('roomActivityChart');
            if (currentCharts.roomActivityChart) {
                currentCharts.roomActivityChart.destroy();
            }

            // Contar actividad por habitaci√≥n
            const roomActivity = {};
            logsData.forEach(log => {
                if (log.roomNumber) {
                    roomActivity[log.roomNumber] = (roomActivity[log.roomNumber] || 0) + 1;
                }
            });

            // Top 10 habitaciones m√°s activas
            const sortedRooms = Object.entries(roomActivity)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            const labels = sortedRooms.map(([room]) => `Habitaci√≥n ${room}`);
            const data = sortedRooms.map(([,count]) => count);

            currentCharts.roomActivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Actividades',
                        data: data,
                        backgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Funciones de filtrado
        window.filterCabanas = function() {
            try {
                const searchTerm = document.getElementById('searchCabanas').value.toLowerCase();
                const statusFilter = document.getElementById('filterStatus').value;
                
                console.log('üîç Filtrando caba√±as:', { searchTerm, statusFilter });
                
                // Si no hay datos de Firebase, generar 18 caba√±as por defecto para filtrar
                let cabanasToFilter = cabanasData;
                if (Object.keys(cabanasData).length === 0) {
                    console.log('üìã Generando 18 caba√±as por defecto para filtrado...');
                    cabanasToFilter = {};
                    for (let i = 1; i <= 18; i++) {
                        cabanasToFilter[i] = {
                            status: 'available',
                            roomNumber: null,
                            startTime: null,
                            lastUpdated: null
                        };
                    }
                }
                
                const filteredCabanas = Object.entries(cabanasToFilter).filter(([id, cabana]) => {
                    const matchesSearch = id.toString().toLowerCase().includes(searchTerm) || 
                                        (cabana.roomNumber && cabana.roomNumber.toString().toLowerCase().includes(searchTerm));
                    const matchesStatus = !statusFilter || cabana.status === statusFilter;
                    return matchesSearch && matchesStatus;
                });

                console.log(`‚úÖ Filtro aplicado: ${filteredCabanas.length} caba√±as encontradas`);
                updateCabanasTable(filteredCabanas);
                
                // Mostrar mensaje de resultado
                if (searchTerm || statusFilter) {
                    showSuccess(`Filtro aplicado: ${filteredCabanas.length} caba√±as encontradas`);
                }
                
            } catch (error) {
                console.error('‚ùå Error al filtrar caba√±as:', error);
                showError('Error al aplicar filtros');
            }
        };

        window.clearFilters = function() {
            try {
                console.log('üßπ Limpiando filtros de caba√±as...');
                
                document.getElementById('searchCabanas').value = '';
                document.getElementById('filterStatus').value = '';
                
                // Mostrar todas las 18 caba√±as
                updateCabanasTable();
                showSuccess('Filtros limpiados - Mostrando todas las 18 caba√±as');
                
                console.log('‚úÖ Filtros de caba√±as limpiados');
                
            } catch (error) {
                console.error('‚ùå Error al limpiar filtros:', error);
                showError('Error al limpiar filtros');
            }
        };

        window.filterLogs = function() {
            try {
                const dateFrom = document.getElementById('logDateFrom').value;
                const dateTo = document.getElementById('logDateTo').value;
                const actionFilter = document.getElementById('logActionFilter').value;
                
                console.log('üîç Filtrando logs:', { dateFrom, dateTo, actionFilter });
                
                let filteredLogs = logsData;
                
                if (dateFrom) {
                    filteredLogs = filteredLogs.filter(log => 
                        new Date(log.timestamp) >= new Date(dateFrom)
                    );
                }
                
                if (dateTo) {
                    filteredLogs = filteredLogs.filter(log => 
                        new Date(log.timestamp) <= new Date(dateTo + 'T23:59:59')
                    );
                }
                
                if (actionFilter) {
                    filteredLogs = filteredLogs.filter(log => log.action === actionFilter);
                }
                
                console.log(`‚úÖ Filtro de logs aplicado: ${filteredLogs.length} registros encontrados`);
                updateLogsTable(filteredLogs);
                
                // Mostrar mensaje de resultado
                if (dateFrom || dateTo || actionFilter) {
                    showSuccess(`Filtro aplicado: ${filteredLogs.length} logs encontrados`);
                }
                
            } catch (error) {
                console.error('‚ùå Error al filtrar logs:', error);
                showError('Error al aplicar filtros de logs');
            }
        };

        window.clearLogFilters = function() {
            try {
                console.log('üßπ Limpiando filtros de logs...');
                
                document.getElementById('logDateFrom').value = '';
                document.getElementById('logDateTo').value = '';
                document.getElementById('logActionFilter').value = '';
                
                updateLogsTable();
                showSuccess('Filtros de logs limpiados');
                
                console.log('‚úÖ Filtros de logs limpiados');
                
            } catch (error) {
                console.error('‚ùå Error al limpiar filtros de logs:', error);
                showError('Error al limpiar filtros de logs');
            }
        };

        // Funciones de reportes
        window.generateReport = function(format) {
            try {
                const dateFrom = document.getElementById('reportDateFrom').value;
                const dateTo = document.getElementById('reportDateTo').value;
                const reportType = document.getElementById('reportType').value;
                
                console.log('üìã Generando reporte:', { format, dateFrom, dateTo, reportType });
                
                if (!dateFrom || !dateTo) {
                    showError('Por favor selecciona un rango de fechas');
                    return;
                }
                
                // Generar reporte
                const reportData = generateReportData(dateFrom, dateTo, reportType);
                showReportPreview(reportData);
                
                // Exportar seg√∫n formato
                if (format === 'pdf') {
                    exportToPDF(reportData);
                } else if (format === 'excel') {
                    exportToExcel(reportData);
                } else if (format === 'csv') {
                    exportToCSV(reportData);
                }
                
                showSuccess(`Reporte ${format.toUpperCase()} generado exitosamente`);
                
            } catch (error) {
                console.error('‚ùå Error al generar reporte:', error);
                showError('Error al generar el reporte');
            }
        };

        // Generar datos del reporte
        function generateReportData(dateFrom, dateTo, reportType) {
            const filteredLogs = logsData.filter(log => {
                const logDate = new Date(log.timestamp);
                return logDate >= new Date(dateFrom) && logDate <= new Date(dateTo + 'T23:59:59');
            });
            
            const reportData = {
                dateFrom,
                dateTo,
                reportType,
                totalActivities: filteredLogs.length,
                statusBreakdown: {},
                roomActivity: {},
                hourlyDistribution: {},
                averageBreakDuration: 0
            };
            
            // An√°lisis por estado
            filteredLogs.forEach(log => {
                reportData.statusBreakdown[log.action] = (reportData.statusBreakdown[log.action] || 0) + 1;
                
                if (log.roomNumber) {
                    reportData.roomActivity[log.roomNumber] = (reportData.roomActivity[log.roomNumber] || 0) + 1;
                }
                
                const hour = new Date(log.timestamp).getHours();
                reportData.hourlyDistribution[hour] = (reportData.hourlyDistribution[hour] || 0) + 1;
            });
            
            return reportData;
        }

        // Mostrar vista previa del reporte
        function showReportPreview(reportData) {
            const reportContent = document.getElementById('reportContent');
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold mb-2">Resumen General</h4>
                        <p><strong>Per√≠odo:</strong> ${new Date(reportData.dateFrom).toLocaleDateString()} - ${new Date(reportData.dateTo).toLocaleDateString()}</p>
                        <p><strong>Total Actividades:</strong> ${reportData.totalActivities}</p>
                        <p><strong>Tipo de Reporte:</strong> ${reportData.reportType}</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold mb-2">Desglose por Estado</h4>
                        ${Object.entries(reportData.statusBreakdown).map(([status, count]) => 
                            `<p><strong>${getStatusText(status)}:</strong> ${count}</p>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            reportContent.innerHTML = html;
        }

        // Funciones de exportaci√≥n
        function exportToPDF(reportData) {
            // Implementar exportaci√≥n a PDF
            showSuccess('Reporte PDF generado (funcionalidad en desarrollo)');
        }

        function exportToExcel(reportData) {
            // Implementar exportaci√≥n a Excel
            showSuccess('Reporte Excel generado (funcionalidad en desarrollo)');
        }

        function exportToCSV(reportData) {
            // Implementar exportaci√≥n a CSV
            showSuccess('Reporte CSV generado (funcionalidad en desarrollo)');
        }

        // Funciones de utilidad
        window.showTab = function(tabName) {
            console.log(`üîÑ Cambiando a pesta√±a: ${tabName}`);
            
            try {
                // Ocultar todas las pesta√±as
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                    tab.classList.remove('active');
                });
                
                // Desactivar todos los botones
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'text-white', 'active');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                
                // Mostrar pesta√±a seleccionada
                const selectedTab = document.getElementById(tabName);
                if (selectedTab) {
                    selectedTab.classList.remove('hidden');
                    selectedTab.classList.add('active');
                    console.log(`‚úÖ Pesta√±a ${tabName} mostrada`);
                } else {
                    console.error(`‚ùå Pesta√±a ${tabName} no encontrada`);
                    return;
                }
                
                // Activar bot√≥n correspondiente
                const activeButton = document.querySelector(`[onclick="showTab('${tabName}')"]`);
                if (activeButton) {
                    activeButton.classList.remove('bg-gray-200', 'text-gray-700');
                    activeButton.classList.add('bg-blue-600', 'text-white', 'active');
                    console.log(`‚úÖ Bot√≥n de ${tabName} activado`);
                } else {
                    console.error(`‚ùå Bot√≥n de ${tabName} no encontrado`);
                }
                
                // Actualizar gr√°ficos si es necesario
                if (tabName === 'overview' || tabName === 'analytics') {
                    console.log(`üìä Actualizando gr√°ficos para ${tabName}`);
                    setTimeout(() => {
                        updateCharts();
                    }, 100);
                }
                
                // Actualizar datos espec√≠ficos de la pesta√±a
                if (tabName === 'cabanas') {
                    console.log(`üè† Actualizando tabla de caba√±as`);
                    updateCabanasTable();
                } else if (tabName === 'logs') {
                    console.log(`üìù Actualizando tabla de logs`);
                    updateLogsTable();
                } else if (tabName === 'reports') {
                    console.log(`üìã Preparando sistema de reportes`);
                    prepareReportsTab();
                }
                
                console.log(`üéØ Pesta√±a ${tabName} activada correctamente`);
                
            } catch (error) {
                console.error(`‚ùå Error al cambiar a pesta√±a ${tabName}:`, error);
            }
        };

        function showStatus(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            const statusText = document.getElementById('statusText');
            
            if (statusMessage && statusText) {
                statusText.textContent = message;
                
                // Remover clases anteriores
                statusMessage.className = 'mx-6 mb-4 p-4 rounded-lg';
                
                // Agregar clases seg√∫n tipo
                if (type === 'error') {
                    statusMessage.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
                } else if (type === 'success') {
                    statusMessage.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
                } else {
                    statusMessage.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
                }
                
                statusMessage.classList.add('border');
                statusMessage.classList.remove('hidden');
                
                console.log(`üì± Estado: ${message}`);
            }
        }

        function hideStatus() {
            const statusMessage = document.getElementById('statusMessage');
            if (statusMessage) {
                statusMessage.classList.add('hidden');
            }
        }

        function showError(message) {
            showStatus(message, 'error');
            setTimeout(() => hideStatus(), 5000);
        }

        function showSuccess(message) {
            showStatus(message, 'success');
            setTimeout(() => hideStatus(), 3000);
        }

        // Funci√≥n para preparar la pesta√±a de reportes
        function prepareReportsTab() {
            console.log('üìã Preparando pesta√±a de reportes...');
            
            // Configurar fechas por defecto si no est√°n configuradas
            const reportDateFrom = document.getElementById('reportDateFrom');
            const reportDateTo = document.getElementById('reportDateTo');
            
            if (reportDateFrom && reportDateTo) {
                const today = new Date();
                const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                
                if (!reportDateFrom.value) {
                    reportDateFrom.value = lastWeek.toISOString().split('T')[0];
                }
                if (!reportDateTo.value) {
                    reportDateTo.value = today.toISOString().split('T')[0];
                }
                
                console.log('üìÖ Fechas de reporte configuradas');
            }
            
            // Limpiar contenido previo del reporte
            const reportContent = document.getElementById('reportContent');
            if (reportContent) {
                reportContent.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-chart-bar text-4xl mb-4"></i>
                        <p class="text-lg">Selecciona un rango de fechas y tipo de reporte para generar la vista previa.</p>
                    </div>
                `;
            }
        }



        // Inicializar dashboard cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM cargado, inicializando dashboard...');
            
            // Configurar fechas por defecto
            const today = new Date();
            const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const logDateFrom = document.getElementById('logDateFrom');
            const logDateTo = document.getElementById('logDateTo');
            const reportDateFrom = document.getElementById('reportDateFrom');
            const reportDateTo = document.getElementById('reportDateTo');
            
            if (logDateFrom) logDateFrom.value = lastWeek.toISOString().split('T')[0];
            if (logDateTo) logDateTo.value = today.toISOString().split('T')[0];
            if (reportDateFrom) reportDateFrom.value = lastWeek.toISOString().split('T')[0];
            if (reportDateTo) reportDateTo.value = today.toISOString().split('T')[0];
            
            console.log('üìÖ Fechas configuradas');
            
            // Inicializar dashboard
            initializeDashboard();
        });
    </script>
</body>
</html>
